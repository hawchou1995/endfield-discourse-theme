// ============================================
// 《明日方舟·终末地》Discourse主题 - 核心样式 V2.0
// ============================================

// 核心强调色 (保持不变的品牌色)
$endfield-blue: #00D4FF;
$endfield-orange: #FF6B35; 

// ============================================
// 1. 全局基础 (自动适配深浅色)
// ============================================

body {
  // 使用系统变量背景，确保浅色模式是白的，深色模式是黑的
  background-color: var(--secondary);
  background-image: 
    linear-gradient(90deg, var(--primary-very-low) 1px, transparent 1px),
    linear-gradient(180deg, var(--primary-very-low) 1px, transparent 1px);
  background-size: 40px 40px; // 技术网格背景
  background-attachment: fixed;
}

// 链接颜色优化
a {
  color: var(--tertiary);
  transition: all 0.2s ease;
  &:hover {
    color: var(--tertiary-hover);
    text-decoration: none;
  }
}

// ============================================
// 2. UI 组件 - 终末地工业风格 (切角设计)
// ============================================

// 通用切角混合宏
@mixin endfield-cut-corner {
  border-radius: 0;
  // 右上角和左下角切角
  clip-path: polygon(
    0 0, 
    calc(100% - 10px) 0, 
    100% 10px, 
    100% 100%, 
    10px 100%, 
    0 calc(100% - 10px)
  );
}

// 按钮重构
.btn {
  @include endfield-cut-corner;
  border: none;
  text-transform: uppercase;
  font-weight: 700;
  letter-spacing: 0.5px;
  position: relative;
  
  // 主按钮 (蓝色)
  &.btn-primary {
    background: var(--tertiary);
    color: var(--secondary);
    
    &:hover {
      background: var(--tertiary-hover);
      transform: translateX(2px); // 悬浮时产生机械位移感
    }
    
    // 装饰性小方块
    &::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 5px;
      height: 5px;
      background: rgba(255,255,255,0.5);
    }
  }
  
  // 次级按钮
  &.btn-default {
    background: var(--primary-low);
    color: var(--primary);
    border: 1px solid var(--primary-low-mid);
    
    &:hover {
      background: var(--primary-low-mid);
    }
  }
}

// ============================================
// 3. 导航栏 (HUD 风格)
// ============================================

.d-header {
  background: var(--header_background);
  border-bottom: 2px solid var(--tertiary); // 顶部亮条
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  backdrop-filter: blur(10px);
  
  // 顶部装饰线
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, $endfield-blue, transparent 20%, transparent 80%, $endfield-blue);
  }

  .title {
    font-weight: 800;
    letter-spacing: -0.5px;
  }
  
  .icons .icon {
    border: 1px solid transparent;
    &:hover {
      background: var(--primary-low);
      border: 1px solid var(--tertiary);
      border-radius: 0; // 强制方形
    }
  }
}

// ============================================
// 4. 话题列表 (数据列表风格)
// ============================================

.topic-list {
  // 移除圆角，强调硬朗线条
  border-radius: 0; 
  
  thead th {
    border-bottom: 2px solid var(--primary-low-mid);
    color: var(--primary-medium);
    font-size: 0.85em;
    text-transform: uppercase;
  }
  
  tbody tr {
    border-bottom: 1px solid var(--primary-low);
    
    &:hover {
      background-color: var(--hover); // 使用 about.json 定义的悬停色
    }
  }
  
  .main-link {
    font-weight: 600;
    
    .link-top-line {
      display: flex;
      align-items: center;
    }
  }
  
  // 分类徽章 - 变为实心小药丸
  .badge-category-bg {
    border-radius: 2px; 
  }
}

// ============================================
// 5. 侧边栏 & 容器 (工业面板)
// ============================================

// 统一卡片样式
.sidebar-section, 
.rs-component,
.topic-list {
  background: var(--secondary); // 适配深浅色背景
  border: 1px solid var(--primary-low);
  box-shadow: 4px 4px 0 var(--primary-low); // 硬阴影
  margin-bottom: 24px;
  position: relative;
  
  // 橙色装饰角
  &::before {
    content: '';
    position: absolute;
    top: -1px;
    left: -1px;
    width: 10px;
    height: 10px;
    border-top: 2px solid $endfield-orange;
    border-left: 2px solid $endfield-orange;
    z-index: 1;
  }
}

// 侧边栏标题
.sidebar-section-header, 
.rs-component h3 {
  border-bottom: 1px solid var(--primary-low);
  padding: 10px 15px;
  background: var(--primary-very-low);
  color: var(--primary);
  font-weight: 700;
  text-transform: uppercase;
  font-size: 0.9em;
  letter-spacing: 1px;
  
  // 标题左侧装饰条
  border-left: 4px solid var(--tertiary); 
}

// 热门标签球体容器修复
.popular-tags__container {
  // 确保在浅色模式下文字可见
  .popular-tags__tag {
    // 强制增加描边或背景以保证在任何背景下可见
    // (这里的样式主要由 Sidebar Blocks 插件控制，但我们加一层保险)
    text-shadow: 0 1px 3px var(--secondary); 
  }
}

// ============================================
// 6. 帖子详情 (阅读区)
// ============================================

.topic-post {
  border-left: 1px solid var(--primary-low);
  
  // 楼主帖子特殊装饰
  &:first-of-type {
    border-left: 3px solid $endfield-orange;
  }
  
  .topic-avatar {
    border-top: none;
    .avatar {
      border-radius: 4px; // 方形头像
      border: 2px solid var(--primary-low);
    }
  }
  
  .cooked {
    // 引用块修复
    blockquote {
      background: var(--primary-very-low);
      border-left: 4px solid var(--tertiary);
      color: var(--primary);
      
      // 移除原主题可能残留的蓝色背景
      &::before {
        color: var(--tertiary);
      }
    }
    
    // 代码块
    pre code {
      background: #1e1e1e; // 代码块始终保持深色背景更易读
      color: #d4d4d4;
      border-radius: 4px;
    }
  }
}

// ============================================
// 7. 搜索框优化
// ============================================
#search-button {
  background: transparent;
  &:hover {
    background: var(--primary-low);
  }
}

// 搜索下拉框
.search-menu .search-context {
  background: var(--secondary);
  border: 1px solid var(--tertiary);
}

// ============================================
// 布局调整：增加话题列表宽度
// ============================================

// 1. 增加主容器最大宽度
// Discourse 默认大约是 1110px，我们加宽它
.wrap {
  max-width: 1400px !important; // 针对大屏优化
  width: 95%; // 在小屏上保持边距
}

// 2. 调整三栏比例 (Grid Layout)
// 默认通常是：导航栏(2/12) - 话题列表(7/12) - 侧边栏(3/12)
// 我们微调一下，给话题列表更多空间
@media (min-width: 1200px) { // 仅在大屏生效
  .container.list-container {
    // 假设 Discourse 使用 flex 或 grid，我们需要强制调整
    // 这里以常见的 flex 布局为例进行微调
    
    // 话题列表区域
    .topic-list {
      // 这里的具体选择器取决于你的布局插件，通常是 table 元素
      // 但更有效的是调整它的父容器
    }
  }
  
  // 如果是 Sidebar Blocks 插件控制的布局：
  // 我们可以尝试压缩右侧边栏宽度
  .tc-right-sidebar {
    width: 280px !important; // 稍微变窄一点 (默认可能300+)
    min-width: 280px !important;
  }
  
  // 增加话题列表区域的 flex 权重
  #list-area {
    flex: 1 1 auto !important; // 让它自动填满剩余空间
    max-width: none !important; // 解除限制
  }
}
